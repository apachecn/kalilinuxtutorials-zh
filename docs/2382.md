# SentryPeer:æ”¶é›†çš„ä¸è‰¯è¡Œä¸ºè€… IP åœ°å€å’Œç”µè¯å·ç çš„åˆ†å¸ƒå¼å¯¹ç­‰åˆ—è¡¨

> åŸæ–‡ï¼š [https://kalilinuxtutorials.com/sentrypeer/](https://kalilinuxtutorials.com/sentrypeer/)

[![](img/0e4cf04f9163afaf5e0e1dd2b6f1b878.png)](https://blogger.googleusercontent.com/img/a/AVvXsEhfWQkl5jLyIOSQO63wbBRH3wXDpUTrZWwAgfNpuBfJZMZCzPfZM13Wi5mmX7m4iagmQBC1PMCOwTu2lknHX8QdVB1o4SQqx7D5AkFBBpQYMNDtF1LL6WQQ_8C4HdVNZ84NnjxA2EtcIuty6LCackfiA1qu6TjYQ_R9e7ADuJr9WSL8jyPWxA-VcCoX=s728)

**SentryPeer** åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ¬ºè¯ˆæ£€æµ‹å·¥å…·ã€‚å®ƒè®©åäººè¯•å›¾æ‰“ç”µè¯ï¼Œå¹¶ä¿å­˜ä»–ä»¬æ¥è‡ªçš„ IP åœ°å€å’Œä»–ä»¬è¯•å›¾å‘¼å«çš„å·ç ã€‚è¿™äº›è¯¦ç»†ä¿¡æ¯éšåè¢«ç”¨äºåœ¨æœåŠ¡æä¾›å•†çš„ç½‘ç»œä¸Šé˜»æ­¢ä»–ä»¬ï¼Œä¸‹æ¬¡ç”¨æˆ·/å®¢æˆ·è¯•å›¾å‘¼å«å¯¹æ–¹ä»˜è´¹å·ç æ—¶ï¼Œè¯¥å·ç å°±ä¼šè¢«é˜»æ­¢ã€‚

ä¼ ç»Ÿä¸Šï¼Œè¿™äº›æ•°æ®è¢«è¿é€åˆ°ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼Œæ‰€ä»¥ä½ ä¸æ‹¥æœ‰ä½ æ”¶é›†çš„æ•°æ®ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯æ‰€æœ‰å…³äºç‚¹å¯¹ç‚¹çš„æ•°æ®å…±äº«ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œæ‹¥æœ‰æ•°æ®å’Œå„ç§æœåŠ¡æä¾›å•†/ç½‘ç»œæä¾›å•†ç›¸å…³æ•°æ®çš„ç”¨æˆ·æ˜¯å…³é”®ã€‚æˆ‘åŒå€¦äº†æ‰€æœ‰é‚£äº›ä¿å­˜å’Œå‡ºå”®å®ƒçš„æœåŠ¡ã€‚å¦‚æœæ‚¨å·²ç»æ”¶é›†äº†å®ƒï¼Œæ‚¨åº”è¯¥å¯ä»¥é€‰æ‹©ä¿ç•™å®ƒå’Œ/æˆ–é€‰æ‹©é€šè¿‡ p2p æ–¹å¼ä¸å…¶ä»– SentryPeer ç¤¾åŒºæˆå‘˜åˆ†äº«å®ƒã€‚

åˆ†äº«çš„éƒ¨åˆ†â€¦åªæœ‰å½“ä½ åˆ†äº«ä½ çš„æ•°æ®æ—¶ï¼Œä½ æ‰èƒ½å¾—åˆ°å…¶ä»–ç”¨æˆ·çš„æ•°æ®ã€‚è¿™æ˜¯å…³é”®ã€‚å¦‚æœæˆ‘åšå¯¹äº†ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨åœ¨è®¸å¤šé¡¹ç›®ä¸­(æ•°æ®é€»è¾‘/ç‰¹æ€§çš„å…±äº«)ã€‚

### æˆªå±

è¿™æ˜¯ä¸€ä¸ªå¯èƒ½ä¼šæ”¹å˜çš„ç½‘ç»œç”¨æˆ·ç•Œé¢çš„æ¨¡å‹ã€‚

![](img/424248f8d422ff1af91eb3de138b35f3.png)

### ç›®æ ‡

*   æ‰€æœ‰ä»£ç è‡ªç”±/è‡ªç”±å’Œå¼€æºè½¯ä»¶
*   å¿«çš„
*   ç”¨æˆ·*æ‹¥æœ‰ä»–ä»¬çš„*æ•°æ®
*   å¦‚æœç”¨æˆ·æ„¿æ„ï¼Œä»–ä»¬å¯ä»¥æäº¤è‡ªå·±çš„æ•°æ®â€”*é€‰æ‹©é€€å‡º*(é»˜è®¤ä¸ºæäº¤æ•°æ®)
*   ç”¨æˆ·è·å–å…¶ä»–ç”¨æˆ·çš„æ•°æ®(é’ˆé”‹ç›¸å¯¹ï¼Ÿ)**åªæœ‰å½“**ä»–ä»¬é€‰æ‹©å°†ä»–ä»¬çš„æ•°æ®æäº¤åˆ°æ± (DHTï¼Ÿâ€“éœ€è¦è¿›è¡Œæ¦‚å¿µéªŒè¯)
*   ä½¿ç”¨ OpenDHT çš„åµŒå…¥å¼åˆ†å¸ƒå¼å“ˆå¸Œè¡¨(DHT)èŠ‚ç‚¹(`**-p**` cli é€‰é¡¹)
*   ä½¿ç”¨ OpenDHT å¯¹ç­‰å…±äº«æ”¶é›†çš„ bad_actors çš„(é»˜è®¤å¼€å¯)
*   ä½¿ç”¨ OpenDHT å°†å¯¹ç­‰æ•°æ®å¤åˆ¶åˆ°**æ¥æ”¶**æ”¶é›†çš„ bad_actors(é»˜è®¤å¼€å¯)
*   å¤šçº¿ç¨‹
*   UDP ä¼ è¾“
*   TCP ä¼ è¾“
*   TLS ä¼ è¾“
*   JSON æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶
*   æ•°æ®æœ€å¤§ 7(ï¼Ÿ)å¤©æ—§ä¸ºæ— ç”¨å¦åˆ™
*   å¯ä»¥ç¦ç”¨ SIP æ¨¡å¼ã€‚è¿™å…è®¸æ‚¨ä»…åœ¨ API æ¨¡å¼æˆ– DHT æ¨¡å¼ä¸‹è¿è¡Œ SentryPeer ç­‰ã€‚å³ï¼Œä¸æ˜¯ä½œä¸ºèœœç½ï¼Œè€Œæ˜¯ä½œä¸º SentryPeer ç¤¾åŒºä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…åªæ˜¯æä¾›å¤åˆ¶çš„æ•°æ®
*   å¯ä»¥å¯ç”¨ SIP å“åº”æ¨¡å¼æ¥æ”¶é›†æ•°æ®â€“CLI/env æ ‡å¿—
*   **æœ¬åœ°**æ•°æ®æ‹·è´ç”¨äº**å¿«é€Ÿè®¿é—®**â€“CLI/env db ä½ç½®æ ‡å¿—
*   **ç”¨äº**å¿«é€Ÿè®¿é—®çš„æœ¬åœ°**API**â€“CLI/env æ ‡å¿—
*   **ç”¨äº**å¿«é€Ÿè®¿é—®çš„æœ¬åœ°**Web GUI**â€“CLI/env æ ‡å¿—
*   æŸ¥è¯¢ API ä»¥è·å–ä¸è‰¯å‚ä¸è€…çš„ IP åœ°å€
*   ä¸è‰¯å‚ä¸è€…çš„ IPSET çš„æŸ¥è¯¢ API
*   é’ˆå¯¹ä¸è‰¯å‚ä¸è€…çš„ç‰¹å®š IP åœ°å€æŸ¥è¯¢ API
*   æŸ¥è¯¢ API ä»¥æŸ¥æ‰¾ä¸è‰¯è¡Œä¸ºè€…å°è¯•æ‹¨æ‰“çš„ç”µè¯å·ç 
*   æŸ¥è¯¢ API ä»¥æŸ¥æ‰¾æ¶æ„ç”¨æˆ·å°è¯•æ‹¨æ‰“çš„ç”µè¯å·ç 
*   æ ¹æ®åŠŸèƒ½è¦æ±‚ï¼Œé€šè¿‡`**syslo**g`æä¾›æ•…éšœ 2 ç¦æ­¢æ”¯æŒ
*   æœ¬åœ° sqlite æ•°æ®åº“â€“åŠŸèƒ½/ cli æ ‡å¿—
*   åˆ†æâ€“é€‰æ‹©åŠ å…¥
*   ç”¨äºå¤–éƒ¨è®¿é—®çš„ SDK/libsâ€“ä» CGRateS å¼€å§‹ï¼Œæˆ–è€…æˆ‘ä»¬è‡ªå·±çš„å¸¦æœ‰ nftables çš„é˜²ç«å¢™
*   ç‰©è”ç½‘ä½¿ç”¨çš„å°å‹äºŒè¿›åˆ¶æ–‡ä»¶
*   è·¨å¹³å°
*   å®æ—¶ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®çš„é˜²ç«å¢™é€‰é¡¹â€“DHTï¼Ÿ
*   æœ€æ–°ç‰ˆæœ¬çš„ Docker Hub ä¸Šçš„å®¹å™¨
*   ä¸ BGP ä»£ç†å¯¹ç­‰ï¼Œç”¨äºé»‘å–æ”¶é›†çš„ IP åœ°å€(ç±»ä¼¼äºå›¢é˜Ÿ Cymru Bogon è·¯ç”±å™¨æœåŠ¡å™¨é¡¹ç›®)
*   SIP ä»£ç†è¿”å› 404 æˆ– SIP é‡å®šå‘çš„é»˜è®¤ç›®çš„åœ°

### è®¾è®¡

TBDğŸ™‚

æˆ‘è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘æƒ³åš C ç½‘ç»œç¼–ç¨‹ï¼Œå› ä¸ºæˆ‘æ¯å¤©ä½¿ç”¨çš„é¡¹ç›®éƒ½æ˜¯ç”¨ C è¯­è¨€ç¼–å†™çš„ï¼Œæ¯”å¦‚ PostgreSQLã€OpenLDAPã€FreeSWITCHã€OpenSIPSã€æ˜Ÿå·ç­‰ç­‰ã€‚å‚è§ã€Šç¬¬ 414 é›†:ç°ä»£ C ä¸Šçš„å»¶æ–¯Â·å¤æ–¯ç‰¹ã€‹äº†è§£ä¸ºä»€ä¹ˆ C æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚å¯¹äºé‚£äº›æ„Ÿå…´è¶£çš„äººï¼Œè¯·çœ‹æˆ‘çš„è½¯ä»¶å·¥ç¨‹ç”µå°æ’­å®¢èŠ‚ç›®åˆ—è¡¨(https://www.se-radio.net/team/gavin-henry/)

### ä¼šè°ˆ

*   tad summit 2021â€“https://blog.tadsummit.com/2021/11/17/sentrypeer/
*   CommCon 2021â€“https://2021 . CommCon . XYZ/talks/sentry peer-a-distributed-peer-to-peer-list-of-bad-IP-addresses-and-phone-numbers-collected-via-a-sip-honey pot

### ç å¤´å·¥äºº

å¯ä»¥ç”¨ Docker è¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„ SentryPeerã€‚æœ€æ–°ç‰ˆæœ¬å¯ä» Docker Hub è·å¾—ã€‚æˆ–è€…æ‰“é€ è‡ªå·±:

**é¡»è—¤åå»ºè®¾-t sentrypeerã€‚
sudo åç«™è¿è¡Œ-d-p 5060:5060-p 8082:8082 sentry peer:latest**

ç„¶åä½ å¯ä»¥åœ¨`**http://localhost:8082/ip-addresses**`å’Œ`**http://localhost:5060/health-check**`æŸ¥çœ‹å®ƒæ˜¯å¦åœ¨è¿è¡Œã€‚

#### ç¯å¢ƒå˜é‡

**env sentry peer _ db _ file =/my/location/sentry peer . db
env sentry peer _ API = 1
env sentry peer _ web _ GUI = 1
env sentry peer _ sip _ response = 1
env sentry peer _ sip _ disable = 1
env sentry peer _ syslog = 1** 

åœ¨ docker æ–‡ä»¶æˆ–æ‚¨çš„`**Dockerfile.env**`æ–‡ä»¶æˆ– docker è¿è¡Œå‘½ä»¤ä¸­è®¾ç½®è¿™äº›ã€‚

### å®‰è£…

Debian æˆ– Fedora åŒ…æ€»æ˜¯å¯ä»¥ä»å½“å‰ç‰ˆæœ¬çš„ SentryPeer çš„å‘å¸ƒé¡µé¢è·å¾—:

https://github.com/SentryPeer/SentryPeer/releases

#### Ubuntu åŒ…

ä½ å¯ä»¥ä»æˆ‘ä»¬çš„ Ubuntu PPD å®‰è£… SentryPeerï¼Œå®ƒç›®å‰é€‚ç”¨äº Ubuntu 20 LTS (Focal Fossa):

**sudo add-apt-repository PPA:gavinhenry/sentrypeer
sudo apt-get æ›´æ–°**

é€šè¿‡å¤åˆ¶ä»¥ä¸‹ä»£ç è¡Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨ç³»ç»Ÿçš„è½¯ä»¶æºä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨å°†æ­¤ PPA æ·»åŠ åˆ°æ‚¨çš„ç³»ç»Ÿä¸­:

**deb https://PPA . launch pad content . net/Gavin Henry/sentry peer/Ubuntu focal main
deb-src https://PPA . launch pad content . net/Gavin Henry/sentry peer/Ubuntu focal main**

#### ä»æºæ„å»º

ä»æºä»£ç å®‰è£…æœ‰ä¸¤ç§é€‰æ‹©ã€‚CMake æˆ–è‡ªåŠ¨å·¥å…·ã€‚ç›®å‰æ¨èä½¿ç”¨è‡ªåŠ¨å·¥å…·ã€‚ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä¸€ä¸ªè‡ªåŠ¨å·¥å…·æ„å»ºã€‚

å¦‚æœæ‚¨æ˜¯ Fedora ç”¨æˆ·ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Fedora copr å®‰è£…å®ƒ:

https://copr.fedorainfracloud.org/coprs/ghenry/SentryPeer/

å¦‚æœæ‚¨è¦ä»è¯¥å­˜å‚¨åº“è¿›è¡Œæ„å»ºï¼Œæ‚¨éœ€è¦å®‰è£…ä»¥ä¸‹è½¯ä»¶:

*   **`git``autoconf``automake`**`**autoconf-archive**`(Debian/Ubuntu)
*   `**libosip2-dev**` (Debian/Ubuntu)æˆ–è€…`**libosip2-devel**` (Fedora)
*   `**libsqlite3-dev**` (Debian/Ubuntu)æˆ–è€…`**sqlite-devel**` (Fedora)
*   `**uuid-dev**` (Debian/Ubuntu)æˆ–è€…`**libuuid-devel**` (Fedora)
*   `**libmicrohttpd-dev**` (Debian/Ubuntu)æˆ–è€…`**libmicrohttpd-devel**` (Fedora)
*   `**libjansson-dev**` (Debian/Ubuntu)æˆ–è€…`**jansson-devel**` (Fedora)
*   `**libpcre2-dev**` (Debian/Ubuntu)æˆ–è€…`**pcre2-devel**` (Fedora)
*   `**libcurl-dev**` (Debian/Ubuntu)æˆ–è€…`**libcurl-devel**` (Fedora)
*   **`libcmocka-dev`** (Debian/Ubuntu)æˆ–`**libcmocka-devel**`(Fedora)â€”â€”ç”¨äºå•å…ƒæµ‹è¯•

Debian/Ubuntu:

**sudo apt-get install git build-essential autoconf-archive autoconf automake lib osip 2-dev libsqlite 3-dev \
libcmocka-dev uuid-dev libcurl-dev libpcre 2-dev libjansson-dev libmicrohttpd-dev**

è½¯å‘¢å¸½:

**sudo dnf install git auto conf auto confke libosip 2-devel libsqlite 3-devel libcmocka-devel \
libuuid-devel libmicrohttpd-devel jansson-devel libcurl-devel pcre 2-devel**

[**Download**](https://github.com/SentryPeer/SentryPeer)