# MITM:ä¸­é—´äººè·¯ç”±å™¨

> åŸæ–‡ï¼š<https://kalilinuxtutorials.com/mitm-man-in-the-middle-router/>

å°†ä»»ä½• linux PC å˜æˆä¸€ä¸ªå¼€æ”¾ Wi-Fiï¼Œå®‰é™åœ°ç»„ç»‡ mitm æˆ–ä¸­é—´äººæ‰€æœ‰ http æ´»åŠ¨ã€‚ä¿æŒåœ¨ Docker å®¹å™¨å†…è¿è¡Œï¼Œåˆ©ç”¨ hostapdã€dnsmasq å’Œ mitmproxy åˆ›å»ºä¸€ä¸ªåä¸ºâ€œopenâ€çš„å¼€æ”¾å¼èœœç½è¿œç¨‹ç³»ç»Ÿã€‚å¯¹äºåŒ…å«çš„ä¹è¶£ï¼Œå°†ç³»ç»Ÿåç§°æ›´æ”¹ä¸ºâ€œxfinitywifi â€,ä»¥è‡ªåŠ¨è¿æ¥ä»»ä½•æ›¾ç»ä¸è¿™äº›ç³»ç»Ÿå…³è”çš„ä¸ªäººâ€¦â€¦å®ƒä»¬éƒ½ç»“æŸäº†ã€‚

```
# clone the repo
git clone https://github.com/brannondorsey/mitm-router
cd mitm-router

# build the image this step can be omitted if you prefer to pull 
# the image from the docker hub repository
docker build . -t brannondorsey/mitm-router
```

è¿è¡Œä»¥ä¸‹ç¨‹åºï¼Œåˆ†åˆ«ç”¨æ‚¨çš„æ— çº¿è®¾å¤‡å’Œè¿æ¥äº’è”ç½‘çš„ä»¥å¤ªç½‘/æ— çº¿è®¾å¤‡æ›¿æ¢`AP_IFACE`å’Œ`INTERNET_IFACE`ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œ`ifconfig`æ¥æŸ¥çœ‹ä½ çš„ç½‘ç»œè®¾å¤‡çš„åç§°ã€‚

**ä¹Ÿè¯» [WiFi å¯†ç è§£å¯†å™¨è½¯ä»¶æ¢å¤æ— çº¿å¯†ç ](http://kalilinuxtutorials.com/wifi-password-decryptor/)**

```
# run the container
docker run -it --net host --privileged \
-e AP_IFACE="wlan0" \
-e INTERNET_IFACE="eth0" \
-e SSID="Public" \
-v "$(pwd)/data:/root/data" \
brannondorsey/mitm-router
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹:

```
Current MAC:   a5:ae:f9:a4:b7:e3 (TP-LINK TECHNOLOGIES CO.,LTD.)
Permanent MAC: a5:ae:f9:a4:b7:e3 (TP-LINK TECHNOLOGIES CO.,LTD.)
New MAC:       00:d2:6b:d5:fe:bd (PHOTRON USA)
[ ok ] Starting system message bus: dbus.
[ ok ] Starting DNS forwarder and DHCP server: dnsmasq.
[ ok ] Starting advanced IEEE 802.11 management: hostapd.
Proxy server listening at http://0.0.0.0:1337 
```

`mitm-router`é€æ˜åœ°æ•è·å‘é€åˆ°`10.0.0.1:80`è·¯ç”±å™¨çš„æ‰€æœ‰`HTTP`æµé‡ã€‚å®ƒä¸ä¼š**è€Œä¸æ˜¯**æ‹¦æˆª HTTPS æµé‡(ç«¯å£`443`ï¼Œå› ä¸ºè¿™æ ·åšä¼šæé†’ç”¨æˆ·å¯èƒ½å‘ç”Ÿäº†ä¸­é—´äººæ”»å‡»ã€‚ä»¥`https://`å¼€å¤´çš„ URL ä¹‹é—´çš„æµé‡ä¸ä¼šè¢«æ•è·ã€‚

æ–‡ä»¶å¤¹`**mitm-router/data/**`ä¸ docker å®¹å™¨å…±äº«ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®ƒæ”¾åœ¨ä¸»æœºä¸Šçš„æ•è·æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨ `**mitm-router/data/http-traffic.cap**`ä¸­æ‰¾åˆ° **`mitmdump`** æŠ“å›¾æ–‡ä»¶ã€‚

æ‚¨è¿˜å¯ä»¥éšæ—¶å°†æ‚¨çš„`INTERNET_IFACE`è¿æ¥åˆ°æ‰‹æœºä¸Šè¿è¡Œçš„ä¸»æœºä¸ŠğŸ˜‰

## **é…ç½®ä¸­é—´äºº** 

ä¸‹é¢åˆ—å‡ºäº†æ”¯æŒçš„ç¯å¢ƒå˜é‡åŠå…¶é»˜è®¤å€¼:

```
# wireless device name that will be used for the Access Point
AP_IFACE="wlan0"

# device name that is used for the router's internal internet connection
# packets from AP_IFACE will be forwarded to this device
INTERNET_IFACE="eth0"

# wireless network name
SSID="Public"

# optional WPA2 password; if left empty network will be public
PASSWORD=""

# optional randomization of AP_IFACE MAC address
# can be set to a specific value like "XX:XX:XX:XX:XX:XX"
# or "unchanged" to leave the device MAC alone
MAC="random"

# tcpdump output file location inside the container
CAPTURE_FILE="/root/data/http-traffic.cap"

# optional mitmproxy filter
# see http://docs.mitmproxy.org/en/stable/features/filters.html
FILTER=""
```

è¯¥æ¥å…¥ç‚¹è¿è¡Œåœ¨ Docker å†…éƒ¨è¿›è¡Œéš”ç¦»ï¼Œç¡®ä¿æ¥å…¥ç‚¹ä¸­ä»»ä½•å¯èƒ½è¢«åˆ©ç”¨çš„æ¼æ´éƒ½ä¸ä¼šå…è®¸å¯¹æ‰‹è®¿é—®æ‚¨çš„è®¡ç®—æœºæˆ–å®¶åº­ç½‘ç»œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦æ³¨æ„ä¸€äº›è­¦å‘Š:

*   **â€“ç½‘ç»œä¸»æœº**ä¸ docker å®¹å™¨å…±äº«æ¥è‡ªä¸»æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£å’Œ **iptables** æ¡ç›®ã€‚å‡è®¾æ˜“å—æ”»å‡»çš„ docker å®¹å™¨æ‹¥æœ‰å¯¹è¿™äº›è®¾å¤‡çš„è¶…çº§ç”¨æˆ·è®¿é—®æƒé™ã€‚
*   åœ¨**â€“ç‰¹æƒ**æ¨¡å¼ä¸‹è¿è¡Œç»™äºˆ docker å®¹å™¨æ‰©å±•çš„æƒé™
*   æ‚¨çš„ä¸»æœº(è¿è¡Œ docker çš„é‚£å°)**å°†**ä½œä¸ºä¸€ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯åœ¨â€œå…¬å…±â€ç½‘ç»œä¸Šå¯è®¿é—®ã€‚å› æ­¤ï¼Œè¯·ä½¿ç”¨é˜²ç«å¢™(linux ä¸Šçš„ ufw)æ¥é˜»æ­¢æ‰€æœ‰ç«¯å£ä¸Šçš„ä¼ å…¥æµé‡ï¼Œä»¥ä¾¿â€œå…¬å…±â€ç½‘ç»œä¸Šçš„è®¡ç®—æœºæ— æ³•è®¿é—®æ‚¨æœºå™¨ä¸Šå…¬å¼€çš„æœåŠ¡ã€‚
*   èœœç½ç½‘ç»œä¸Šçš„æ‰€æœ‰æµé‡éƒ½å°†ä»æ‚¨å®¶åº­ç½‘ç»œçš„ç½‘å…³æµå‡ºã€‚å¦‚æœæœ‰äººåœ¨â€œå…¬å…±â€ç½‘ç»œä¸Šè¿›è¡Œéæ³•æ´»åŠ¨ï¼Œä½ å°†è¢«è¿½ç©¶è´£ä»»ï¼Œä½ çš„ ISP å¯èƒ½ä¼šå–æ¶ˆä½ çš„æœåŠ¡ã€‚

ä¸ºäº†å¢åŠ å®‰å…¨æ€§ï¼Œæˆ‘æ›´å–œæ¬¢åœ¨ä¸“ç”¨è®¡ç®—æœºä¸Šè¿è¡Œè¿™ä¸ª docker å®¹å™¨ï¼Œæ¯”å¦‚ Raspberry Piã€‚

[![](img//a51de913dc60eee505c4a68651ee8e4d.png)](https://github.com/brannondorsey/mitm-router)